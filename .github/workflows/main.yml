name: main

on:
  pull_request: {}

jobs:
  call-workflow-setup-environment:
    uses: ./.github/workflows/setup-environment.yml
    with:
      # tessellation_commit_hash: "f07e2c70ad20f02ed33601803dd86b6a32b2517f"
      use_merge_commit: true
    secrets: inherit

  debug-outputs:
    runs-on: ubuntu-latest
    needs: call-workflow-setup-environment
    steps:
      - name: Debug outputs
        run: |
          echo "call-workflow-setup-environment outputs: ${{ toJSON(needs.call-workflow-setup-environment.outputs) }}"

  call-governance-tests:
    needs: [call-workflow-setup-environment]
    uses: ./.github/workflows/governance_tests.yml
    with:
      tessellation_version: ${{ needs.call-workflow-setup-environment.outputs.tessellation_version }}
    secrets: inherit

  call-amm-operations-tests:
    needs: [call-workflow-setup-environment]
    uses: ./.github/workflows/amm_operations_test.yml
    with:
      tessellation_version: ${{ needs.call-workflow-setup-environment.outputs.tessellation_version }}
    secrets: inherit
